/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-optional-resolution",
factory: function (require) {
var plugin=(()=>{var m=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var u=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,o)=>(typeof require<"u"?require:t)[o]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});var I=(e,t)=>{for(var o in t)m(e,o,{get:t[o],enumerable:!0})},R=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of j(t))!A.call(e,s)&&s!==o&&m(e,s,{get:()=>t[s],enumerable:!(r=W(t,s))||r.enumerable});return e};var U=e=>R(m({},"__esModule",{value:!0}),e);var w={};I(w,{default:()=>q,dummyPkgDist:()=>k,isDummyPkg:()=>y});var g=u("@yarnpkg/core"),a=u("semver");var b=e=>{let t=Array.from(e.manifest.getForScope("dependencies").values()),o=new Map;for(let[r,s]of e.manifest.dependenciesMeta?.entries())if(s.get(null)?.optional){let i=g.structUtils.parseIdent(r);o.set(r,t.find(c=>c.scope===i.scope&&c.name===i.name).range)}return o},d,x={validateWorkspace:e=>{if(!d)d=new Map(Array.from(b(e).entries()).map(([t,o])=>[t,new Set([o])]));else for(let[t,o]of b(e))d.set(t,d.has(t)?new Set([o,...d.get(t)]):new Set([o]))},wrapNetworkRequest:async(e,t)=>{let o=d?void 0:process.argv.includes("--optional")||process.argv.includes("-O"),r,s,i=t.target.toString(),c=[t.configuration.get("npmRegistryServer"),...Array.from(t.configuration.get("npmScopes").values()).map(p=>p.get("npmRegistryServer"))].find(p=>p&&i.startsWith(p));if(c){i=i.substring(c.length+(c.endsWith("/")?0:1));let p=i.indexOf("?");p>-1&&(i=i.substring(0,p)),i.indexOf("/")<=-1&&(r=decodeURIComponent(i),d&&d.has(r)?s=Array.from(d.get(r)):o?s=["0.0.0"]:r=void 0)}return s?async()=>{let p=n=>Object.fromEntries(n.map(f=>[(0,a.minVersion)(f),{name:r,dist:k}])),l=!0,D=n=>l?n:JSON.parse(n.toString()),h=n=>({statusCode:200,headers:{},body:l?n:JSON.stringify(n)});try{let n=await e();l=typeof n.body=="object"&&!(n.body instanceof Buffer);let f=D(n.body),O=Object.keys(f.versions),H=s.filter(C=>!(0,a.minSatisfying)(O,C));return H.length?(Object.assign(f.versions,p(H)),h(f)):n}catch(n){if(n.name!=="HTTPError"||n.response.statusCode!==404)throw n;l=typeof g.YarnVersion>"u"||!(0,a.valid)((0,a.coerce)(g.YarnVersion))||(0,a.gte)((0,a.coerce)(g.YarnVersion),"4.0.0");let f=p(s);return h({name:r,["dist-tags"]:{latest:`${(0,a.rsort)(Object.keys(f))[0]}`},versions:f})}}:e}},P=x;var S=u("@yarnpkg/core");var B={beforeWorkspacePacking:async(e,t)=>{let{project:o}=e;if(!t.optionalDependencies)return;let r=!1;for(let s of e.manifest.getForScope("dependencies").values()){let i=S.structUtils.stringifyIdent(s);await o.restoreInstallState();let c=Array.from(o.storedPackages.values()).find(p=>p.identHash===s.identHash);c&&y(decodeURIComponent(c.reference))&&(r=!0,delete t.optionalDependencies[i],delete e.manifest.raw.optionalDependencies[i],e.manifest.dependencies.delete(s.identHash))}r&&(t.optionalDependencies.length||(delete t.optionalDependencies,delete e.manifest.raw.optionalDependencies),await o.configuration.triggerHook(s=>s.beforeWorkspacePacking,e,t))}},v=B;var k={shasum:"8835645b033793d09c5afb90ccee155b73b728f3",tarball:"https://registry.npmjs.org/optional-pkg/-/optional-pkg-1.0.0.tgz"},y=e=>/\/optional-pkg\/-\/optional-pkg-.*\.tgz$/.test(e),N={hooks:{...P,...v}},q=N;return U(w);})();
return plugin;
}
};
