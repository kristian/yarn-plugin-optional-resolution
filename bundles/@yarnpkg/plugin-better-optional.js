/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-better-optional",
factory: function (require) {
var plugin=(()=>{var C=Object.create,g=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames,H=Object.getOwnPropertySymbols,O=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var P=(e,o,t)=>o in e?g(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,m=(e,o)=>{for(var t in o||(o={}))h.call(o,t)&&P(e,t,o[t]);if(H)for(var t of H(o))x.call(o,t)&&P(e,t,o[t]);return e};var R=e=>g(e,"__esModule",{value:!0});var f=e=>{if(typeof require!="undefined")return require(e);throw new Error('Dynamic require of "'+e+'" is not supported')};var U=(e,o)=>{for(var t in o)g(e,t,{get:o[t],enumerable:!0})},j=(e,o,t)=>{if(o&&typeof o=="object"||typeof o=="function")for(let n of I(o))!h.call(e,n)&&n!=="default"&&g(e,n,{get:()=>o[n],enumerable:!(t=A(o,n))||t.enumerable});return e},k=e=>j(R(g(e!=null?C(O(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var F={};U(F,{default:()=>E,dummyPkgDist:()=>u,isDummyPkg:()=>y});var v=k(f("@yarnpkg/core")),d=k(f("semver"));var S=e=>{var n,i;let o=Array.from(e.manifest.getForScope("dependencies").values()),t=new Map;for(let[r,p]of(n=e.manifest.dependenciesMeta)==null?void 0:n.entries())if((i=p.get(null))==null?void 0:i.optional){let s=v.structUtils.parseIdent(r);t.set(r,o.find(c=>c.scope===s.scope&&c.name===s.name).range)}return t},a,q={validateWorkspace:e=>{if(!a)a=new Map(Array.from(S(e).entries()).map(([o,t])=>[o,new Set([t])]));else for(let[o,t]of S(e))a.set(o,a.has(o)?new Set([t,...a.get(o)]):new Set([t]))},wrapNetworkRequest:async(e,o)=>{let t=a?void 0:process.argv.includes("--optional")||process.argv.includes("-O"),n,i,r=o.target.toString(),p=[o.configuration.get("npmRegistryServer"),...Array.from(o.configuration.get("npmScopes").values()).map(s=>s.get("npmRegistryServer"))].find(s=>s&&r.startsWith(s));if(p){r=r.substring(p.length+(p.endsWith("/")?0:1));let s=r.indexOf("?");s>-1&&(r=r.substring(0,s)),r.indexOf("/")<=-1&&(n=decodeURIComponent(r),a&&a.has(n)?i=Array.from(a.get(n)):t?i=["0.0.0"]:n=void 0)}return i?async()=>{try{return await e()}catch(s){if(s.name!=="HTTPError"||s.response.statusCode!==404)throw s;let c=i.map(l=>(0,d.minVersion)(l));return{body:JSON.stringify({name:n,["dist-tags"]:{latest:`${(0,d.rsort)(c)[0]}`},versions:Object.fromEntries(c.map(l=>[l,{name:n,dist:u}]))})}}}:e}},b=q;var D=k(f("@yarnpkg/core"));var w={beforeWorkspacePacking:async(e,o)=>{let{project:t}=e;if(!o.optionalDependencies)return;let n=!1;for(let i of e.manifest.getForScope("dependencies").values()){let r=D.structUtils.stringifyIdent(i);await t.restoreInstallState();let p=Array.from(t.storedPackages.values()).find(s=>s.identHash===i.identHash);p&&y(decodeURIComponent(p.reference))&&(n=!0,delete o.optionalDependencies[r],delete e.manifest.raw.optionalDependencies[r],e.manifest.dependencies.delete(i.identHash))}n&&(o.optionalDependencies.length||(delete o.optionalDependencies,delete e.manifest.raw.optionalDependencies),await t.configuration.triggerHook(i=>i.beforeWorkspacePacking,e,o))}},W=w;var u={shasum:"8835645b033793d09c5afb90ccee155b73b728f3",tarball:"https://registry.npmjs.org/optional-pkg/-/optional-pkg-1.0.0.tgz"},y=e=>/\/optional-pkg\/-\/optional-pkg-.*\.tgz$/.test(e),z={hooks:m(m({},b),W)},E=z;return F;})();
return plugin;
}
};
